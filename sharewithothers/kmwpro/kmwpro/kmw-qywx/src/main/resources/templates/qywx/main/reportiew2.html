<!DOCTYPE html>
<html lang="zh">
<head>
    <th:block th:include="include :: header('查询日报记录')" />
</head>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeIn">

    <div class="container-div">
        <div class="row">
            <div class="col-sm-12 search-collapse">
                <form id="formId">
                    <div class="select-list">
                        <ul>
                            <!--   <li>
                                  <p>所在项目组名称：</p>
                                  <input type="text" name="projectGroupId"/>
                              </li> -->
                            <!--                            <li>
                                                            <p>完成比例：</p>
                                                            <input type="text" name="finishPercent"/>
                                                        </li>-->

                            <!-- <li>
                                <p>对应计划：</p>
                                <input type="text" name="accordYesterday"/>
                            </li>
                            <li>
                                <p>是否重要：</p>
                                <input type="text" name="isImportant"/>
                            </li>
                            <li>
                                <p>是否紧急：</p>
                                <input type="text" name="isEmergency"/>
                            </li>
                            <li>
                                <p>重要级别：</p>
                                <input type="text" name="impoLevel"/>
                            </li>
                            <li>
                                <p>逻辑删除标记(0.正常，1.删除)：</p>
                                <input type="text" name="delFlag"/>
                            </li>
                            <li>
                                <p>状态：</p>
                                <select name="status">
                                    <option value="">所有</option>
                                </select>
                            </li> -->
                            <!-- <li>
                                <p>机构ID：</p>
                                <input type="text" name="instId"/>
                            </li>
                            <li>
                                <p>登录IP：</p>
                                <input type="text" name="loginIp"/>
                            </li>
                            <li class="select-time">
                                <p>登录日期：</p>
                                <input type="text" class="time-input" id="startTime" placeholder="开始时间" name="params[beginLoginDate]"/>
                                <span>-</span>
                                <input type="text" class="time-input" id="endTime" placeholder="结束时间" name="params[endLoginDate]"/>
                            </li> -->
                            <!--  <li>
                                 <p>创建人：</p>
                                 <input type="text" name="createBy"/>
                             </li>
                             <li class="select-time">
                                 <p>创建时间：</p>
                                 <input type="text" class="time-input" id="startTime" placeholder="开始时间" name="params[beginCreateDate]"/>
                                 <span>-</span>
                                 <input type="text" class="time-input" id="endTime" placeholder="结束时间" name="params[endCreateDate]"/>
                             </li>
                             <li>
                                 <p>最近修改人：</p>
                                 <input type="text" name="updateBy"/>
                             </li>
                             <li class="select-time">
                                 <p>最近修改时间：</p>
                                 <input type="text" class="time-input" id="startTime" placeholder="开始时间" name="params[beginUpdateDate]"/>
                                 <span>-</span>
                                 <input type="text" class="time-input" id="endTime" placeholder="结束时间" name="params[endUpdateDate]"/>
                             </li> -->

                            <li>
                                <p>项目组：</p>
                                <select name="manageBusinessDepartment" th:with="type=${@dict.getType('qywx_dept_team')}">
                                    <option value="">所有</option>
                                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
                                </select>
                            </li>
                            <li>
                                <p>姓名：</p>
                                <input type="text" name="remarks"/>
                            </li>
                            <li class="select-time">
                                <p>报告日期：</p>
                                <input type="text" class="time-input" id="startTime" placeholder="开始时间" name="beginReportDate"/>
                                <span>-</span>
                                <input type="text" class="time-input" id="endTime" placeholder="结束时间" name="endReportDate"/>
                            </li>

                            <!--  <li>
                                 <p>报告人ID：</p>
                                 <input type="text" name="reporterId"/>
                             </li>
                             <li>
                                 <p>报告人名称：</p>
                                 <input type="text" name="reporterName"/>
                             </li>
                             <li>
                                 <p>录入内容序号：</p>
                                 <input type="text" name="inputOrder"/>
                             </li> -->
<!--                             <li>
                                <p>是否补报：</p>
                                <input type="text" name="isAfter"/>
                            </li> -->
                            <li>
                                <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
                                <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i class="fa fa-refresh"></i>&nbsp;重置</a>
                            </li>
                        </ul>
                    </div>
                </form>
            </div>
            <div class="col-sm-12 select-table table-striped">
                <table id="bootstrap-table"></table>
            </div>
        </div>
    </div>

    </div>
    <th:block th:include="include :: footer" />
<script th:inline="javascript">
    var prefix = ctx + "qywx/work";
    $(function() {
        var options = {
            url: prefix + "/qywxlist",
            modalName: "工作记录信息",
            sortable: true,                     //是否启用排序
            sortOrder: "asc",                   //排序方式
            columns: [{
                checkbox: true
            },
                {
                    field : 'remarks',
                    title : '姓名',
                    sortable:true
                },
                {
                    field : 'reportDate',
                    title : '报告日期',
                    sortable:true
                },
                {
                    field : 'productName',
                    title : '项目名称',
                    visible:false
                },
                {
                    field : 'projectGroupId',
                    title : '所在项目组名称',
                    visible:false

                },
                {
                    field : 'projectId',
                    title : '项目ID',
                    visible:false
                },
                {
                    field : 'productId',
                    title : '对应产品',
                    visible:false
                },
                {
                    field : 'workContents',
                    title : '工作内容简写',
                    formatter: function(value, row, index) {
                        return $.table.tooltip(value);
                    }
                },
                {
                    field : 'workDetail',
                    title : '工作内容详细描述',
                    formatter: function(value, row, index) {
                        return $.table.tooltip(value);
                    }
                },
                {
                    field : 'finishPercent',
                    title : '完成比例'
                },
                {
                    field : 'delayReason',
                    title : '延迟原因',
                    visible:false
                },
                {
                    field : 'accordYesterday',
                    title : '对应计划',
                    visible:false
                },
                {
                    field : 'isImportant',
                    title : '是否重要',
                    visible:false
                },
                {
                    field : 'isEmergency',
                    title : '是否紧急',
                    visible:false
                },
                {
                    field : 'impoLevel',
                    title : '重要级别',
                    visible:false
                },
                {
                    field : 'id',
                    title : '主键',
                    visible: false
                },
                {
                    field : 'delFlag',
                    title : '逻辑删除标记(0.正常，1.删除)',
                    visible:false
                },
                {
                    field : 'status',
                    title : '状态',
                    visible:false
                },
                {
                    field : 'instId',
                    title : '机构ID',
                    visible:false
                },
                {
                    field : 'loginIp',
                    title : '登录IP',
                    visible:false
                },
                {
                    field : 'loginDate',
                    title : '登录日期',
                    visible:false
                },
                {
                    field : 'createBy',
                    title : '创建人',
                    visible:false
                },
                {
                    field : 'createDate',
                    title : '创建时间',
                    visible:false
                },
                {
                    field : 'updateBy',
                    title : '最近修改人',
                    visible:false
                },
                {
                    field : 'updateDate',
                    title : '最近修改时间',
                    visible:false
                },

                {
                    field : 'reporterId',
                    title : '报告人ID',
                    visible:false
                },
                {
                    field : 'reporterName',
                    title : '报告人名称',
                    visible:false
                },
                {
                    field : 'inputOrder',
                    title : '录入内容序号',
                    visible:false
                },
                {
                    field : 'isAfter',
                    title : '是否补报',
                    formatter: function(value,row,index) {
                        //通过判断单元格的值，来格式化单元格，返回的值即为格式化后包含的元素
                        var a = "";
                        if(value == "0") {
                            var a = '<span style="color:#0000ff">'+'正常提交'+'</span>';
                        }else if(value == "1"){
                            var a = '<span style="color:#FF0000">'+'补报提交'+'</span>';
                        }else if(value == "2") {
                            var a = '<span style="color:#00ff00">'+'提交计划'+'</span>';
                        }else{
                            var a = '<span>'+value+'</span>';
                        }
                        return a;
                    }
                }/*,
                {
                    title: '操作',
                    align: 'center',
                    formatter: function(value, row, index) {
                        var actions = [];
                        actions.push('<a class="btn btn-success btn-xs ' + editFlag + '" href="javascript:void(0)" onclick="$.operate.edit(\'' + row.id + '\')"><i class="fa fa-edit"></i>编辑</a> ');
                        actions.push('<a class="btn btn-danger btn-xs ' + removeFlag + '" href="javascript:void(0)" onclick="$.operate.remove(\'' + row.id + '\')"><i class="fa fa-remove"></i>删除</a>');
                        return actions.join('');
                    }
                }
                */
                ]
        };
        $.table.init(options);
    });





    $(document).ready(function (){

      if(judgeIEType()== false)        return;
        //获取当前用户用户userId
        //以下两行代码调试时注掉
        var urlCode = location.href.split("code=")[1].split('&')[0];
        var userCode = getcookie("userId");
       // console.log("地址ID"+urlCode);
       // console.log("用户ID"+userCode);
        //以下代码调试时打开
       // userCode = 'Zhaozulong';  //置上默认的用户名
      // var urlCode ='P1iJnyb-09zdfDiAVt6LOAP24DQJOQViJ873bAJIWEQ'; //置上默认的微信传来的参数code=P1iJnyb-09zdfDiAVt6LOAP24DQJOQViJ873bAJIWEQ&state=STATE
        if (userCode == "") {
            $.ajax({
                url: "http://krmsoft.natapp1.cc/qywx/main/wxgetJSSUser",
                data: {
                    data: urlCode
                },
                type: "POST",
                success: function (result) {
                    console.log(result);
                    addcookie("userId", result);
                    showTable();//显示table
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log(jqXHR);
                    console.log(textStatus);
                    console.log(errorThrown);
                }
            });
        }
        var userCodeLog = getcookie("userId");
        console.log(userCodeLog);
    });

/*function judgeIEType() {
    var ua = window.navigator.userAgent.toLowerCase();
    if ((ua.match(/MicroMessenger/i) == 'micromessenger') && (ua.match(/wxwork/i) == 'wxwork')) {
    // 企业微信客户端
        return true;
    } else if (ua.match(/micromessenger/i) == 'micromessenger') {
     // 微信客户端
    // window.location.replace('../pages/error.html')
        return true
    } else {
        // 浏览器
        alert("请用企业微信客户端来打开网页！");
      window.location.replace('../error.html')
        return false;
    }
}*/
    //存Cookie的值 仅同级文件可用
    function addcookie(name, value, expireHours) {
        var exp = new Date();
        exp.setTime(exp.getTime() + expireHours);
        document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString();
    }


    //存Cookie的值 加了cookie作用域 会产生全局有效的cookie
    function ADDcookie(name, value, expireHours) {
        var exp = new Date();
        exp.setTime(exp.getTime() + expireHours);
        document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString() + "; path=/";
    }

    function GetCookies(offset) {
        var endstr = document.cookie.indexOf(";", offset);
        if (endstr == -1) endstr = document.cookie.length;
        return unescape(document.cookie.substring(offset, endstr));
    }


    //取Cookie的值
    function getcookie(name) {
        var arg = name + "=";
        var alen = arg.length;
        var clen = document.cookie.length;
        var i = 0;
        while (i < clen) {
            var j = i + alen;
            if (document.cookie.substring(i, j) == arg) return GetCookies(j);
            i = document.cookie.indexOf(" ", i) + 1;
            if (i == 0) break;
        }
        return "";
    }


    /* 通过map带参调用后台的方法Demo
      function openDemo(){
          var url1 =  prefix+"/tableDataInfo";
          var url2 =  prefix+"/queryPageInfo";
          var url3 =  prefix+"/queryOneEntity";
          var	data = $('#formId').serialize();
            var config = {
                url: url3,
                type: "post",
                dataType: "json",
                data: data,
                beforeSend: function () {
                //	$.modal.loading("正在处理中，请稍后...");
                },
                success: function(result) {
                }
            };
            $.ajax(config)
    } */
</script>
</body>
</html>
